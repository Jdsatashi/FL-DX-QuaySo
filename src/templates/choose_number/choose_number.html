{% extends 'layouts/layout.html' %}
{% block header %}
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
{% endblock header %}

{% block content %}
    <div class="w-auto h-auto sm-max:h-full sm-max:w-full -z-20">
        <img src="{{ url_for('static', filename='assets/background.jpg')}}" alt="Background">
    </div>
    <!-- Card modal -->
    <div id="overlay" tabindex="-1"
         class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 bg-slate-700 bg-opacity-75 justify-center items-center w-full md:inset-0 h-full"
         style="display: none;">
        <div class="grid place-items-center mt-40 sm-max:mt-28">
            <div class="card-simple lg:w-[760px] md-max:w-full" id="main-modal">
                <div class="w-full h-full">
                    <div class="card-header bg-green-100 mb-1">
                        <h2 class="card-title">Xác nhận lựa chọn.</h2>
                    </div>
                    <div class="card-content bg-green-50 mt-4 w-full h-auto ring-1 ring-amber-100 ring-opacity-10">
                        <div class="element-center">
                            <p class="w-auto text-xl md-max:text-2xl">Các số đã chọn:</p>
                        </div>
                        <div class="flex justify-center mt-3 w-auto">
                            <div id="confirm-result"
                                 class="w-auto md-max:w-full grid grid-cols-4 md-max:grid-cols-3 xl-max:text-xl">
                            </div>
                        </div>
                        <div class="flex items-end justify-end me-4">
                            <button type="button" class="button-simple" id="close-modal-btn">Close
                            </button>
                            <form id="modal-form" method="post" action="">
                                {{ form.csrf_token() }}
                                {{ form.number(id="modal-input", style="display: none") }}
                                {{ form.submit(class="btn-primary ms-3", id="submit-modal-btn") }}
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <div class="w-auto sm-max:mt-2 -mt-40">
        <div class="element-center">
            <div class="card-simple lg:w-[760px] md-max:w-full">
                <div class="w-full h-full">
                    <div class="card-header bg-green-100 mb-1">
                        <h2 class="card-title">Chọn số may mắn</h2>
                    </div>
                    <div class="card-content bg-green-50 mt-4 w-full mb-4 h-auto ring-1 ring-amber-100 ring-opacity-10">
                        <div class="element-center flex-wrap">
                            <h3 class="w-auto text-xl md-max:text-2xl font-bold me-4 sm-max:mb-2">Sự kiện:
                                "{{ events['event_name'] }}"</h3>
                            {% if number_rolled %}
                                <p class="w-auto text-xl md-max:text-2xl sm-max:mb-2">Tài khoản "{{ user['username'] }}"
                                    đã chọn {{ turn_chosen }} lần, bạn còn
                                    <strong>{{ user['turn_roll'] - turn_chosen }}</strong> lượt chọn số.</p>
                            {% else %}
                                <p class="w-auto text-xl md-max:text-2xl sm-max:mb-2">Tài khoản "{{ user['username'] }}"
                                    được chọn
                                    <strong>{{ user['turn_roll'] }}</strong> số.</p>
                            {% endif %}
                        </div>
                        <div class="element-center max-w-sm mx-auto">
                            <div class="mb-3 mt-3">
                                <label for="input-search-number"></label>
                                <input type="text" id="input-search-number"
                                       class="input-e w-[300px] md-max:w-full md-max:text-xl xl-max:text-xl"
                                       placeholder="Tìm số"
                                       title="Nhập số cần tìm"
                                >
                            </div>
                        </div>
                        <div class="flex justify-center mt-3 w-auto">
                            <div id="show-selected-number"
                                 class="w-auto md-max:w-full grid grid-cols-5 md-max:grid-cols-4 xl-max:text-xl">
                            </div>
                        </div>
                        <div class="element-center mb-3">
                            <button type="button" class="button-simple-green" id="open-modal-btn"
                                    title="Xác nhận chọn số">
                                Xác nhận
                            </button>
                        </div>
                        <div id="user-id" class="hidden">{{ user['_id'] }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div id="group-data">
            <div class="mx-32 w-full md-max:mx-0">
                {% if number_rolled %}
                    <h2 class="text-2xl">Các số đã chọn. Click chọn lại hoặc chọn số khác</h2>
                    <div class="w-auto grid grid-cols-5">
                        {% for number in number_rolled %}
                            <p id="li-{{ number }}"
                               class="group-item"
                               title="Nhấn để chọn số"
                            >{{ number }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
                <h3 class="text-2xl">Các số khả dụng:</h3>
            </div>
            <div class="w-auto mx-32 my-4 grid grid-cols-10 lg-max:mx-4 lg-max:grid-cols-6 ">
                {% for number in number_list %}
                    <p id="li-{{ number }}"
                       class="group-item"
                       title="Nhấn để chọn số"
                    >{{ number }}</p>
                {% endfor %}
            </div>
        </div>
    </div>
    <script type="module" src="{{ url_for('static', filename='scripts/number-search.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='scripts/modal.js') }}"></script>
    <script type="text/javascript">
        JdModal({
            idOpenModal: 'open-modal-btn',
            idCloseModal: 'close-modal-btn',
            idModalParent: 'overlay',
            idMainModal: 'main-modal',
            idShowNumberToConfirm: 'show-selected-number',
            idModalForm: 'modal-form',
            idModalInput: 'modal-input',
            idModalConfirm: 'confirm-result'
        })
    </script>
{% endblock %}
